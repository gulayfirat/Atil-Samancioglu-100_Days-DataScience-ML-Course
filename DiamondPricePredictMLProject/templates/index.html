<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pırlanta Fiyat Tahmini</title>
    <style>
      :root {
        --bg: #0f172a;
        --card: #111827;
        --muted: #94a3b8;
        --text: #e5e7eb;
        --accent: #22c55e;
        --accent-2: #3b82f6;
        --danger: #ef4444;
        --shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
        --grad-1: #60a5fa;
        --grad-2: #a78bfa;
        --grad-3: #22d3ee;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        background: radial-gradient(
            1200px 800px at 20% -10%,
            #1f2937 10%,
            transparent 60%
          ),
          radial-gradient(800px 600px at 120% 10%, #0b3b77 10%, transparent 60%),
          var(--bg);
        color: var(--text);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }

      .container {
        width: 100%;
        max-width: 980px;
        padding: 24px;
      }

      .header {
        text-align: center;
        margin-bottom: 24px;
      }

      .badge {
        display: inline-block;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 11px;
        color: #0b1220;
        background: linear-gradient(
          90deg,
          var(--grad-1),
          var(--grad-2),
          var(--grad-3)
        );
        background-size: 200% 200%;
        animation: flow 6s ease infinite;
        margin-bottom: 10px;
      }

      .title {
        margin: 0 0 8px 0;
        font-size: 30px;
        letter-spacing: 0.2px;
        background: linear-gradient(90deg, #fff, #93c5fd, #e9d5ff);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .subtitle {
        margin: 0;
        color: var(--muted);
        font-size: 14px;
      }

      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.04),
          rgba(255, 255, 255, 0.02)
        );
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        box-shadow: var(--shadow);
        padding: 20px;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 16px;
      }

      .col-6 {
        grid-column: span 6;
      }
      .col-4 {
        grid-column: span 4;
      }
      .col-3 {
        grid-column: span 3;
      }
      .col-12 {
        grid-column: span 12;
      }

      @media (max-width: 820px) {
        .col-6,
        .col-4,
        .col-3,
        .col-12 {
          grid-column: span 12;
        }
      }

      label {
        display: block;
        margin: 4px 0 8px;
        font-size: 13px;
        color: var(--muted);
      }
      input,
      select {
        width: 100%;
        padding: 12px 14px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(2, 6, 23, 0.7);
        color: var(--text);
        outline: none;
        transition: border-color 0.15s ease, box-shadow 0.15s ease;
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
      }
      input:focus,
      select:focus {
        border-color: var(--accent-2);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      }
      .hint {
        font-size: 12px;
        color: var(--muted);
        margin-top: 6px;
      }

      .two-col {
        display: grid;
        grid-template-columns: 1.2fr 0.8fr;
        gap: 20px;
      }
      @media (max-width: 920px) {
        .two-col {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        height: 100%;
      }
      .info-panel {
        background: linear-gradient(
          180deg,
          rgba(59, 130, 246, 0.12),
          rgba(59, 130, 246, 0.04)
        );
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: 14px;
        padding: 16px;
      }
      .info-title {
        margin: 0 0 8px 0;
        font-size: 14px;
        color: #bfdbfe;
      }
      .info-list {
        margin: 0;
        padding-left: 16px;
        color: #cbd5e1;
        font-size: 13px;
      }
      .diamond-svg {
        width: 100%;
        max-width: 220px;
        margin: 8px auto 0;
        display: block;
        opacity: 0.9;
      }

      .actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 12px;
      }
      button {
        border: 0;
        padding: 12px 16px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.04s ease, box-shadow 0.15s ease, opacity 0.2s;
      }
      .btn-primary {
        background: linear-gradient(180deg, #60a5fa, #2563eb);
        color: white;
        box-shadow: 0 6px 16px rgba(37, 99, 235, 0.35);
      }
      .btn-primary:active {
        transform: translateY(1px);
      }
      .btn-reset {
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
      }
      .btn-preset {
        background: rgba(255, 255, 255, 0.06);
        color: #c7d2fe;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .btn-primary[disabled] {
        opacity: 0.7;
        cursor: not-allowed;
      }

      .result {
        margin-top: 18px;
        padding: 16px;
        background: rgba(34, 197, 94, 0.08);
        border: 1px solid rgba(34, 197, 94, 0.25);
        border-radius: 12px;
        display: none;
      }

      .error {
        margin-top: 18px;
        padding: 14px;
        background: rgba(239, 68, 68, 0.08);
        border: 1px solid rgba(239, 68, 68, 0.25);
        border-radius: 12px;
        display: none;
        color: #fecaca;
      }

      .footer-note {
        margin-top: 18px;
        font-size: 12px;
        color: var(--muted);
        text-align: center;
      }

      .row {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 12px;
      }
      .row > .span-6 {
        grid-column: span 6;
      }
      .row > .span-12 {
        grid-column: span 12;
      }
      @media (max-width: 820px) {
        .row > .span-6,
        .row > .span-12 {
          grid-column: span 12;
        }
      }

      .field-inline {
        position: relative;
      }
      .unit {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        font-size: 12px;
        pointer-events: none;
      }

      .spinner {
        width: 16px;
        height: 16px;
        border-radius: 999px;
        border: 2px solid rgba(255, 255, 255, 0.6);
        border-top-color: transparent;
        display: inline-block;
        margin-right: 8px;
        animation: spin 0.7s linear infinite;
        vertical-align: -2px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      @keyframes flow {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <span class="badge">FastAPI · ML · Kaggle Diamonds</span>
        <h1 class="title">Pırlanta Fiyat Tahmini</h1>
        <p class="subtitle">
          Kaggle diamonds verisi ile eğitilmiş model üzerinden anlık tahmin
        </p>
      </div>

      <div class="card two-col">
        <form id="predict-form" class="panel">
          <div class="grid">
            <div class="col-3">
              <label for="carat">Carat</label>
              <div class="field-inline">
                <input
                  id="carat"
                  name="carat"
                  type="number"
                  step="0.01"
                  min="0.0"
                  placeholder="Örn: 0.7"
                  required
                />
                <span class="unit">ct</span>
              </div>
              <div class="hint">Ağırlık (ct)</div>
            </div>

            <div class="col-3">
              <label for="depth">Depth</label>
              <div class="field-inline">
                <input
                  id="depth"
                  name="depth"
                  type="number"
                  step="0.01"
                  min="0"
                  max="100"
                  placeholder="Örn: 61.8"
                  required
                />
                <span class="unit">%</span>
              </div>
            </div>

            <div class="col-3">
              <label for="table">Table</label>
              <div class="field-inline">
                <input
                  id="table"
                  name="table"
                  type="number"
                  step="0.01"
                  min="0"
                  max="100"
                  placeholder="Örn: 57.0"
                  required
                />
                <span class="unit">%</span>
              </div>
            </div>

            <div class="col-3">
              <label for="cut">Kesim (Cut)</label>
              <select id="cut" name="cut" required>
                <option value="" disabled selected>Seçiniz</option>
                <option>Fair</option>
                <option>Good</option>
                <option>Very Good</option>
                <option>Premium</option>
                <option>Ideal</option>
              </select>
            </div>

            <div class="col-3">
              <label for="color">Renk (Color)</label>
              <select id="color" name="color" required>
                <option value="" disabled selected>Seçiniz</option>
                <option>J</option>
                <option>I</option>
                <option>H</option>
                <option>G</option>
                <option>F</option>
                <option>E</option>
                <option>D</option>
              </select>
            </div>

            <div class="col-3">
              <label for="clarity">Berraklık (Clarity)</label>
              <select id="clarity" name="clarity" required>
                <option value="" disabled selected>Seçiniz</option>
                <option>I1</option>
                <option>SI2</option>
                <option>SI1</option>
                <option>VS2</option>
                <option>VS1</option>
                <option>VVS2</option>
                <option>VVS1</option>
                <option>IF</option>
              </select>
            </div>

            <div class="col-3">
              <label for="x">Uzunluk X (mm)</label>
              <div class="field-inline">
                <input
                  id="x"
                  name="x"
                  type="number"
                  step="0.01"
                  min="0"
                  placeholder="Örn: 5.7"
                  required
                />
                <span class="unit">mm</span>
              </div>
            </div>

            <div class="col-3">
              <label for="y">Genişlik Y (mm)</label>
              <div class="field-inline">
                <input
                  id="y"
                  name="y"
                  type="number"
                  step="0.01"
                  min="0"
                  placeholder="Örn: 5.7"
                  required
                />
                <span class="unit">mm</span>
              </div>
            </div>

            <div class="col-3">
              <label for="z">Derinlik Z (mm)</label>
              <div class="field-inline">
                <input
                  id="z"
                  name="z"
                  type="number"
                  step="0.01"
                  min="0"
                  placeholder="Örn: 3.5"
                  required
                />
                <span class="unit">mm</span>
              </div>
            </div>

            <div class="col-12 actions">
              <button type="submit" class="btn-primary" id="predict-btn">
                <span class="btn-text">Fiyatı Tahmin Et</span>
              </button>
              <button type="button" id="reset-btn" class="btn-reset">
                Sıfırla
              </button>
              <button
                type="button"
                class="btn-preset"
                id="preset-budget"
                title="Uygun fiyat örnek değerleri doldurur"
              >
                Örnek: Bütçe
              </button>
              <button
                type="button"
                class="btn-preset"
                id="preset-premium"
                title="Yüksek kalite örnek değerleri doldurur"
              >
                Örnek: Premium
              </button>
            </div>
          </div>
        </form>

        <div class="panel info-panel">
          <h4 class="info-title">İpuçları</h4>
          <ul class="info-list">
            <li>
              Cut: Ideal veya Premium genelde daha yüksek fiyatla ilişkilidir.
            </li>
            <li>Color: D'ye yaklaştıkça renk daha beyaz ve fiyat artar.</li>
            <li>Clarity: IF en yüksek berraklıktır; I1 en düşüğüdür.</li>
            <li>Depth ve Table, oran olarak % cinsindedir.</li>
          </ul>
          <svg
            class="diamond-svg"
            viewBox="0 0 200 120"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <defs>
              <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0%" stop-color="#60a5fa" />
                <stop offset="50%" stop-color="#a78bfa" />
                <stop offset="100%" stop-color="#22d3ee" />
              </linearGradient>
            </defs>
            <polygon
              points="20,40 60,10 140,10 180,40 100,110"
              stroke="url(#g1)"
              stroke-width="2"
              fill="rgba(99,102,241,.15)"
            />
            <polyline
              points="60,10 100,40 140,10"
              stroke="url(#g1)"
              stroke-width="2"
            />
            <polyline
              points="20,40 100,40 180,40"
              stroke="url(#g1)"
              stroke-width="2"
            />
            <polyline
              points="60,10 20,40 100,110 180,40 140,10"
              stroke="url(#g1)"
              stroke-width="2"
            />
          </svg>
          <div id="error" class="error"></div>
          <div id="result" class="result"></div>
        </div>
      </div>

      <div class="footer-note">
        Alanları doldurup "Fiyatı Tahmin Et" butonuna basın.
      </div>
    </div>

    <script>
      const form = document.getElementById("predict-form");
      const resultEl = document.getElementById("result");
      const errorEl = document.getElementById("error");
      const resetBtn = document.getElementById("reset-btn");
      const predictBtn = document.getElementById("predict-btn");
      const presetBudget = document.getElementById("preset-budget");
      const presetPremium = document.getElementById("preset-premium");

      function showResult(text) {
        resultEl.style.display = "block";
        resultEl.textContent = text;
      }

      function showError(text) {
        errorEl.style.display = "block";
        errorEl.textContent = text;
      }

      function hideMessages() {
        resultEl.style.display = "none";
        errorEl.style.display = "none";
      }

      resetBtn.addEventListener("click", () => {
        form.reset();
        hideMessages();
      });

      function setLoading(isLoading) {
        const btnText = predictBtn.querySelector(".btn-text");
        if (isLoading) {
          predictBtn.disabled = true;
          btnText.innerHTML = '<span class="spinner"></span>Tahmin ediliyor...';
        } else {
          predictBtn.disabled = false;
          btnText.textContent = "Fiyatı Tahmin Et";
        }
        Array.from(form.elements).forEach(
          (el) => (el.disabled = isLoading && el.id !== "reset-btn")
        );
      }

      function fill(values) {
        for (const [k, v] of Object.entries(values)) {
          const el = document.getElementById(k);
          if (!el) continue;
          el.value = v;
        }
      }

      presetBudget?.addEventListener("click", () => {
        fill({
          carat: 0.7,
          depth: 61.8,
          table: 57,
          cut: "Good",
          color: "H",
          clarity: "SI2",
          x: 5.7,
          y: 5.7,
          z: 3.5,
        });
      });
      presetPremium?.addEventListener("click", () => {
        fill({
          carat: 1.2,
          depth: 62.0,
          table: 56,
          cut: "Ideal",
          color: "D",
          clarity: "VVS1",
          x: 6.8,
          y: 6.8,
          z: 4.2,
        });
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideMessages();
        setLoading(true);

        const readNumber = (id) => {
          const v = document.getElementById(id).value.trim();
          if (v === "") return null;
          const n = Number(v);
          return Number.isFinite(n) ? n : null;
        };

        const payload = {
          carat: readNumber("carat"),
          cut: document.getElementById("cut").value,
          color: document.getElementById("color").value,
          clarity: document.getElementById("clarity").value,
          depth: readNumber("depth"),
          table: readNumber("table"),
          x: readNumber("x"),
          y: readNumber("y"),
          z: readNumber("z"),
        };

        // Basit doğrulama
        for (const [k, v] of Object.entries(payload)) {
          if (v === null || v === "" || v === undefined) {
            showError(
              "Lütfen tüm alanları geçerli biçimde doldurun. Eksik alan: " + k
            );
            return;
          }
        }

        try {
          const res = await fetch("/predict", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!res.ok) {
            const text = await res.text();
            throw new Error(text || "İstek başarısız oldu");
          }

          const data = await res.json();
          const price = Number(data.predicted_price);
          if (Number.isFinite(price)) {
            const formatted = new Intl.NumberFormat("en-US", {
              style: "currency",
              currency: "USD",
              maximumFractionDigits: 2,
            }).format(price);
            showResult(`Tahmini Fiyat: ${formatted}`);
          } else {
            showError("Beklenmeyen yanıt alındı.");
          }
        } catch (err) {
          showError(
            "Hata: " + (err && err.message ? err.message : "Bilinmeyen hata")
          );
        } finally {
          setLoading(false);
        }
      });
    </script>
  </body>
</html>
